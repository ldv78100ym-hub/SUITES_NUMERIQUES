<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cahier d'Exercices : Suites Arithm√©tiques</title>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']],
                packages: ['base', 'ams', 'noerrors', 'noundefined']
            },
            startup: {
                typeset: false
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #e67e22;
            --bg-color: #f4f6f7;
            --text-color: #333;
            --box-bg: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }

        h1, h2, h3 { color: var(--primary-color); }
        h1 { text-align: center; border-bottom: 3px solid var(--accent-color); padding-bottom: 10px; }

        .container { max-width: 900px; margin: 0 auto; }

        .card {
            background: var(--box-bg);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid var(--accent-color);
        }

        .card.theory { border-left-color: #8e44ad; }
        .card.problem { border-left-color: #d35400; }
        .card.exercise { border-left-color: #27ae60; border: 2px solid #27ae60; }

        .btn-container { text-align: center; margin: 20px 0; display: flex; justify-content: center; gap: 15px; }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        .btn-refresh { background-color: var(--primary-color); color: white; }
        .btn-refresh:hover { background-color: #34495e; }

        .btn-show-sol {
            background-color: var(--warning-color);
            color: white;
            font-weight: bold;
            display: block;
            margin: 15px 0;
            font-size: 14px;
        }
        .btn-show-sol:hover { background-color: #d35400; }

        .solution-box {
            display: none;
            background-color: #e8f6f3;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #d1f2eb;
            animation: fadeIn 0.4s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .highlight { font-weight: bold; color: var(--accent-color); }
        
        canvas { background: #fff; border: 1px solid #ccc; display: block; margin: 10px auto; max-width: 100%; }

        .step-calc { 
            background: #fff3cd; 
            padding: 10px; 
            border-left: 4px solid #ffc107; 
            margin: 5px 0;
            font-family: 'Courier New', monospace;
        }

        .schema-box {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }

        .arrow {
            display: inline-block;
            margin: 0 5px;
            color: #d32f2f;
            font-weight: bold;
        }

        .term-box {
            display: inline-block;
            background: white;
            border: 2px solid #333;
            border-radius: 4px;
            padding: 5px 10px;
            margin: 2px;
            min-width: 40px;
        }

        .jump-label {
            color: #d32f2f;
            font-size: 0.9em;
            font-weight: bold;
        }

        .suite-type-badge {
            display: inline-block;
            background: #ffebee;
            color: #c62828;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
            margin-left: 10px;
            border: 1px solid #ef9a9a;
        }

        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); }
        .modal-content { background-color: #fff; margin: 10% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 8px; }
        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover { color: black; }
    </style>
</head>
<body>

<div class="container">
    <h1>Entra√Ænement : Suites Arithm√©tiques</h1>
    
    <div class="btn-container">
        <button class="btn-refresh" onclick="generateContent()">üîÑ G√©n√©rer un nouveau sujet (Al√©atoire)</button>
        <button style="background:#7f8c8d; color:white;" onclick="openModal()">‚öñÔ∏è Cr√©dits</button>
    </div>

    <div class="card">
        <h2>1. Reconna√Ætre une suite (R√©currence)</h2>
        <div id="ex-recurrence"></div>
    </div>

    <div class="card theory">
        <h2>2. Formule explicite</h2>
        <div id="ex-explicit"></div>
    </div>

    <div class="card">
        <h2>3. Repr√©sentation Graphique</h2>
        <p>Observez la disposition des points ci-dessous.</p>
        <div id="ex-graph-text"></div>
        <canvas id="canvasGraph" width="500" height="300"></canvas>
    </div>

    <div class="card">
        <h2>4. Prouver qu'une suite n'est PAS arithm√©tique <span id="suite-type-label" class="suite-type-badge"></span></h2>
        <div id="ex-counter"></div>
    </div>

    <div class="card problem">
        <h2>5. Probl√®me de la vie courante</h2>
        <div id="pbl-content"></div>
    </div>

    <div class="card exercise">
        <h2 style="color:#27ae60;">6. Exercices d'Entra√Ænement Rapide (M√©thode Pas-√†-Pas)</h2>
        <p>Calculez terme par terme, puis observez le sch√©ma r√©capitulatif.</p>
        <hr style="border:0; border-top:1px dashed #ccc;">
        <div id="drill-exercises"></div>
    </div>

</div>

<div id="copyrightModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h3>‚öñÔ∏è Droits d'Auteur et Licence d'Utilisation</h3>
        <strong>Conditions :</strong>
        <p>Utilisation Priv√©e et √âducative (Autoris√©e) : Vous √™tes autoris√©.e √† utiliser, copier, modifier et distribuer ce code et son contenu uniquement √† des fins personnelles, √©ducatives et non lucratives.</p>
        <p>Utilisation Commerciale (Interdite) : Toute utilisation, distribution, int√©gration ou reproduction du code ou du contenu (total ou partiel) √† des fins commerciales, lucratives ou professionnelles est strictement interdite sans un accord √©crit pr√©alable et explicite de l'auteur.</p>
        <p>Attribution : Toute reproduction ou modification doit conserver la mention de l'auteur originale (Yann Merdy) et la pr√©sente notice de droits d'auteur. Pour toute demande d'utilisation commerciale ou de licence sp√©cifique, veuillez contacter l'auteur √† l'adresse indiqu√©e ci-dessus.</p>
    </div>
</div>

<script>
    function getRandomInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
    function formatSignedNumber(n) { return n >= 0 ? `+ ${n}` : `- ${Math.abs(n)}`; }

    function toggleSol(id) {
        let box = document.getElementById('sol-' + id);
        let btn = document.getElementById('btn-' + id);
        
        if (box.style.display === "none" || box.style.display === "") {
            box.style.display = "block";
            btn.innerHTML = "üôà Masquer la solution";
            btn.style.backgroundColor = "#7f8c8d";
        } else {
            box.style.display = "none";
            btn.innerHTML = "üëÅÔ∏è Voir la solution";
            btn.style.backgroundColor = "#e67e22";
        }
    }

    function generateContent() {
        generateRecurrence();
        generateExplicit(); 
        generateCounterExample();
        generateGraph();
        generatePBL();
        generateDrills();
        
        if (window.MathJax) { MathJax.typesetPromise(); }
    }

    function generateRecurrence() {
        let u0 = getRandomInt(-20, 20);
        let r = getRandomInt(-10, 10);
        while(r === 0) r = 5;
        
        let html = `
            <p>Soit la suite d√©finie par \\( u_0 = ${u0} \\) et \\( u_{n+1} = u_n ${formatSignedNumber(r)} \\).</p>
            <p><strong>Question :</strong> Quelle est la nature de cette suite ? Donnez sa raison.</p>
            
            <button id="btn-rec" class="btn-show-sol" onclick="toggleSol('rec')">üëÅÔ∏è Voir la solution</button>
            <div id="sol-rec" class="solution-box">
                <p>La diff√©rence \\( u_{n+1} - u_n = ${r} \\) est constante.</p>
                <p>C'est donc une suite <strong>arithm√©tique</strong> de raison \\( r = ${r} \\).</p>
            </div>
        `;
        document.getElementById('ex-recurrence').innerHTML = html;
    }

    function generateExplicit() {
        let a = getRandomInt(-10, 10);
        while (a === 0) a = 3;
        let b = getRandomInt(-20, 20);
        
        let html = `
            <p>Soit la suite d√©finie par : \\( u_n = ${a}n ${formatSignedNumber(b)} \\).</p>
            <p><strong>Question :</strong> Prouvez qu'elle est arithm√©tique.</p>

            <button id="btn-exp" class="btn-show-sol" onclick="toggleSol('exp')">üëÅÔ∏è Voir la solution</button>
            <div id="sol-exp" class="solution-box">
                <p>Calculons \\( u_{n+1} - u_n \\) :</p>
                <p>\\( u_{n+1} = ${a}(n+1) ${formatSignedNumber(b)} = ${a}n + ${a} ${formatSignedNumber(b)} \\)</p>
                <p>\\( u_{n+1} - u_n = (${a}n + ${a} ${formatSignedNumber(b)}) - (${a}n ${formatSignedNumber(b)}) = ${a} \\).</p>
                <p>Le r√©sultat est constant. La suite est arithm√©tique de raison \\( r = ${a} \\).</p>
            </div>
        `;
        document.getElementById('ex-explicit').innerHTML = html;
    }

    function generateGraph() {
        let canvas = document.getElementById('canvasGraph');
        let ctx = canvas.getContext('2d');
        let u0 = getRandomInt(-5, 5);
        let r = getRandomInt(1, 4);
        
        document.getElementById('ex-graph-text').innerHTML = `
            <p>Suite : \\( u_0=${u0} \\) et \\( r=${r} \\). Les points sont-ils align√©s ?</p>
        `;

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        let margin = 40;
        let w = canvas.width - 2 * margin;
        let h = canvas.height - 2 * margin;
        let maxY = u0 + 5 * r;
        let minY = Math.min(0, u0);
        let rangeY = maxY - minY + 2;
        let scaleX = w / 5;
        let scaleY = h / rangeY;

        ctx.beginPath();
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.moveTo(margin, margin); ctx.lineTo(margin, canvas.height - margin);
        let yZero = canvas.height - margin - (0 - minY) * scaleY;
        if (yZero > canvas.height - margin) yZero = canvas.height - margin;
        if (yZero < margin) yZero = margin;
        ctx.moveTo(margin, yZero); ctx.lineTo(canvas.width - margin, yZero);
        ctx.stroke();

        ctx.fillStyle = '#e74c3c';
        for(let n=0; n<5; n++) {
            let un = u0 + n * r;
            let px = margin + n * scaleX;
            let py = canvas.height - margin - (un - minY) * scaleY;
            ctx.beginPath(); ctx.arc(px, py, 6, 0, 2 * Math.PI); ctx.fill();
            ctx.fillStyle = '#000'; ctx.font = '12px Arial'; 
            ctx.fillText('u' + n, px + 5, py - 10); 
            ctx.fillStyle = '#e74c3c';
        }
    }

    /* Exercice 4 VARI√â avec diff√©rents types de suites non arithm√©tiques */
    function generateCounterExample() {
        let type = getRandomInt(0, 4); // 5 types diff√©rents
        let c = getRandomInt(-5, 5);
        let k = getRandomInt(2, 4);
        let html = "";
        let label = "";
        
        switch(type) {
            case 0: // Quadratique : n¬≤ + c
                label = "Quadratique";
                let u0_q = c;
                let u1_q = 1 + c;
                let u2_q = 4 + c;
                let diff1_q = u1_q - u0_q;
                let diff2_q = u2_q - u1_q;
                
                html = `
                    <p>Soit \\( u_n = n^2 ${formatSignedNumber(c)} \\).</p>
                    <p><strong>Question :</strong> Est-ce une suite arithm√©tique ? Justifiez.</p>
                    
                    <button id="btn-count" class="btn-show-sol" onclick="toggleSol('count')">üëÅÔ∏è Voir la solution</button>
                    <div id="sol-count" class="solution-box">
                        <p>Calculons les premiers termes :</p>
                        <ul>
                            <li>\\( u_0 = 0^2 ${formatSignedNumber(c)} = ${u0_q} \\)</li>
                            <li>\\( u_1 = 1^2 ${formatSignedNumber(c)} = ${u1_q} \\) (√©cart = ${diff1_q > 0 ? '+' : ''}${diff1_q})</li>
                            <li>\\( u_2 = 2^2 ${formatSignedNumber(c)} = ${u2_q} \\) (√©cart = ${diff2_q > 0 ? '+' : ''}${diff2_q})</li>
                        </ul>
                        <p>Les √©carts ne sont pas constants (\\(${diff1_q} \\neq ${diff2_q}\\)).<br>
                        Ce n'est <strong>PAS</strong> une suite arithm√©tique (c'est une suite quadratique).</p>
                    </div>
                `;
                break;
                
            case 1: // Cubique : n¬≥ + c
                label = "Cubique";
                let u0_c = c;
                let u1_c = 1 + c;
                let u2_c = 8 + c;
                let diff1_c = u1_c - u0_c;
                let diff2_c = u2_c - u1_c;
                
                html = `
                    <p>Soit \\( u_n = n^3 ${formatSignedNumber(c)} \\).</p>
                    <p><strong>Question :</strong> Est-ce une suite arithm√©tique ? Justifiez.</p>
                    
                    <button id="btn-count" class="btn-show-sol" onclick="toggleSol('count')">üëÅÔ∏è Voir la solution</button>
                    <div id="sol-count" class="solution-box">
                        <p>Calculons les premiers termes :</p>
                        <ul>
                            <li>\\( u_0 = 0^3 ${formatSignedNumber(c)} = ${u0_c} \\)</li>
                            <li>\\( u_1 = 1^3 ${formatSignedNumber(c)} = ${u1_c} \\) (√©cart = ${diff1_c > 0 ? '+' : ''}${diff1_c})</li>
                            <li>\\( u_2 = 2^3 ${formatSignedNumber(c)} = ${u2_c} \\) (√©cart = ${diff2_c > 0 ? '+' : ''}${diff2_c})</li>
                        </ul>
                        <p>Les √©carts ne sont pas constants (${diff1_c} \\neq ${diff2_c}).<br>
                        Ce n'est <strong>PAS</strong> une suite arithm√©tique (c'est une suite cubique).</p>
                    </div>
                `;
                break;
                
            case 2: // G√©om√©trique : k^n + c
                label = "G√©om√©trique";
                let u0_g = 1 + c; // k^0 = 1
                let u1_g = k + c;
                let u2_g = k*k + c;
                let diff1_g = u1_g - u0_g;
                let diff2_g = u2_g - u1_g;
                
                html = `
                    <p>Soit \\( u_n = ${k}^n ${formatSignedNumber(c)} \\).</p>
                    <p><strong>Question :</strong> Est-ce une suite arithm√©tique ? Justifiez.</p>
                    
                    <button id="btn-count" class="btn-show-sol" onclick="toggleSol('count')">üëÅÔ∏è Voir la solution</button>
                    <div id="sol-count" class="solution-box">
                        <p>Calculons les premiers termes :</p>
                        <ul>
                            <li>\\( u_0 = ${k}^0 ${formatSignedNumber(c)} = 1 ${formatSignedNumber(c)} = ${u0_g} \\)</li>
                            <li>\\( u_1 = ${k}^1 ${formatSignedNumber(c)} = ${k} ${formatSignedNumber(c)} = ${u1_g} \\) (√©cart = ${diff1_g > 0 ? '+' : ''}${diff1_g})</li>
                            <li>\\( u_2 = ${k}^2 ${formatSignedNumber(c)} = ${k*k} ${formatSignedNumber(c)} = ${u2_g} \\) (√©cart = ${diff2_g > 0 ? '+' : ''}${diff2_g})</li>
                        </ul>
                        <p>Les √©carts ne sont pas constants (${diff1_g} \\neq ${diff2_g}).<br>
                        Ce n'est <strong>PAS</strong> une suite arithm√©tique (c'est une suite g√©om√©trique de raison ${k}).</p>
                    </div>
                `;
                break;
                
            case 3: // Fractionnaire : 1/(n+1) + c
                label = "Fractionnaire";
                // Utiliser n+1 pour √©viter la division par z√©ro
                let u0_f = 1 + c; // 1/1 = 1
                let u1_f = Math.floor(100 * (0.5 + c)) / 100; // 1/2 = 0.5
                let u2_f = Math.floor(100 * (0.333 + c)) / 100; // 1/3 ‚âà 0.33
                // Pour les √©carts, on garde les fractions exactes
                let diff1_f = "1/2"; // u1 - u0 = 0.5 - 1 = -0.5
                let diff2_f = "1/6"; // u2 - u1 = 0.333 - 0.5 = -0.166...
                
                if(c !== 0) {
                    diff1_f = "variable";
                    diff2_f = "variable";
                }
                
                html = `
                    <p>Soit \\( u_n = \\dfrac{1}{n+1} ${formatSignedNumber(c)} \\).</p>
                    <p><strong>Question :</strong> Est-ce une suite arithm√©tique ? Justifiez.</p>
                    
                    <button id="btn-count" class="btn-show-sol" onclick="toggleSol('count')">üëÅÔ∏è Voir la solution</button>
                    <div id="sol-count" class="solution-box">
                        <p>Calculons les premiers termes :</p>
                        <ul>
                            <li>\\( u_0 = \\dfrac{1}{1} ${formatSignedNumber(c)} = ${1+c} \\)</li>
                            <li>\\( u_1 = \\dfrac{1}{2} ${formatSignedNumber(c)} = ${c > 0 ? c + 0.5 : c - 0.5} \\) (√©cart n√©gatif)</li>
                            <li>\\( u_2 = \\dfrac{1}{3} ${formatSignedNumber(c)} \\approx ${(1/3 + c).toFixed(2)} \\) (autre √©cart)</li>
                        </ul>
                        <p>Les diff√©rences ne sont pas constantes.<br>
                        Ce n'est <strong>PAS</strong> une suite arithm√©tique (les d√©nominateurs changent).</p>
                    </div>
                `;
                break;
                
            case 4: // Altern√©e : (-1)^n * k
                label = "Altern√©e";
                let u0_a = k; // (-1)^0 = 1
                let u1_a = -k; // (-1)^1 = -1
                let u2_a = k; // (-1)^2 = 1
                
                html = `
                    <p>Soit \\( u_n = (-1)^n \\times ${k} \\).</p>
                    <p><strong>Question :</strong> Est-ce une suite arithm√©tique ? Justifiez.</p>
                    
                    <button id="btn-count" class="btn-show-sol" onclick="toggleSol('count')">üëÅÔ∏è Voir la solution</button>
                    <div id="sol-count" class="solution-box">
                        <p>Calculons les premiers termes :</p>
                        <ul>
                            <li>\\( u_0 = (-1)^0 \\times ${k} = ${u0_a} \\)</li>
                            <li>\\( u_1 = (-1)^1 \\times ${k} = ${u1_a} \\) (√©cart = ${u1_a - u0_a})</li>
                            <li>\\( u_2 = (-1)^2 \\times ${k} = ${u2_a} \\) (√©cart = ${u2_a - u1_a})</li>
                        </ul>
                        <p>Les √©carts ne sont pas constants (${u1_a - u0_a} \\neq ${u2_a - u1_a}).<br>
                        Ce n'est <strong>PAS</strong> une suite arithm√©tique (la suite alterne entre ${k} et ${-k}).</p>
                    </div>
                `;
                break;
        }
        
        document.getElementById('suite-type-label').innerHTML = label;
        document.getElementById('ex-counter').innerHTML = html;
    }

    function generatePBL() {
        let initial = getRandomInt(20, 100);
        let saving = getRandomInt(10, 30);
        let months = getRandomInt(5, 8);
        
        let html = `
            <p>Paul a ${initial} ‚Ç¨ et √©conomise ${saving} ‚Ç¨ par mois.</p>
            <p><strong>Question :</strong> Combien aura-t-il dans ${months} mois ?</p>
            
            <button id="btn-pbl" class="btn-show-sol" onclick="toggleSol('pbl')">üëÅÔ∏è Voir la solution</button>
            <div id="sol-pbl" class="solution-box">
                <p><strong>M√©thode : Calculons mois par mois</strong></p>
                <div class="step-calc">`;
        
        let current = initial;
        for(let i=0; i<=months; i++) {
            if(i === 0) {
                html += `Mois 0 (d√©part) : ${current} ‚Ç¨<br>`;
            } else {
                let prev = current;
                current += saving;
                html += `Mois ${i} : ${prev} + ${saving} = ${current} ‚Ç¨<br>`;
            }
        }
        
        html += `</div>
                <p>Au bout de ${months} mois, Paul aura <strong>${current} ‚Ç¨</strong>.</p>
                
                <div class="schema-box">
                    <h4>üîç Observation du sch√©ma :</h4>
                    <p style="font-size:0.9em;">On a fait ${months} ajouts de ${saving} ‚Ç¨</p>
                    <div style="margin:15px 0; font-size:1.1em;">
                        <span class="term-box">${initial}</span>`;
        
        for(let i=0; i<months; i++) {
            html += `<span class="arrow">‚Üí(+${saving})‚Üí</span>`;
        }
        
        html += `<span class="term-box" style="background:#c8e6c9;">${current}</span>
                    </div>
                    <p class="jump-label">Total des ajouts : ${months} √ó ${saving} = ${months*saving}</p>
                    <p style="margin-top:10px; font-style:italic; color:#666;">
                        Remarque : On aurait pu calculer directement ${initial} + ${months}√ó${saving} = ${current}<br>
                        mais la m√©thode pas-√†-pas v√©rifie le r√©sultat !
                    </p>
                </div>
            </div>
        `;
        document.getElementById('pbl-content').innerHTML = html;
    }

    function generateDrills() {
        let container = document.getElementById('drill-exercises');
        let html = "";

        // EXERCICE A
        let u0_a = getRandomInt(1, 10);
        let r_a = getRandomInt(2, 5);
        let n_a = getRandomInt(4, 7);
        
        html += `
        <div style="margin-bottom:30px;">
            <p><strong>Exercice A :</strong> suite arithm√©tique de raison \\( r=${r_a} \\) et \\( u_0=${u0_a} \\). 
            Calculez \\( u_{${n_a}} \\) en d√©taillant tous les termes.</p>
            
            <button id="btn-dr1" class="btn-show-sol" onclick="toggleSol('dr1')">üëÅÔ∏è Voir la solution</button>
            <div id="sol-dr1" class="solution-box">
                <p><strong>Calculs interm√©diaires :</strong></p>
                <div class="step-calc">`;
        
        let val_a = u0_a;
        for(let i=0; i<=n_a; i++) {
            if(i === 0) {
                html += `\\( u_${i} = ${val_a} \\)<br>`;
            } else if(i === n_a) {
                html += `<strong>\\( u_${i} = ${val_a} \\)</strong> ‚Üê Terme demand√©<br>`;
            } else {
                html += `\\( u_${i} = ${val_a} \\)<br>`;
            }
            if(i < n_a) val_a += r_a;
        }
        
        html += `</div>
                
                <div class="schema-box">
                    <h4>üîó Sch√©ma des sauts :</h4>
                    <p>De \\( u_0 \\) √† \\( u_${n_a} \\), il y a ${n_a} "sauts" de \\( ${r_a} \\)</p>
                    <div style="margin:15px 0; font-family:monospace; font-size:1.2em;">
                        <span class="term-box">${u0_a}</span>`;
        
        let curr = u0_a;
        for(let i=1; i<=n_a; i++) {
            curr += r_a;
            html += `<span style="color:#d32f2f; font-weight:bold;">‚Üí(+${r_a})‚Üí</span>`;
            if(i === n_a) {
                html += `<span class="term-box" style="background:#ffeb3b; border-color:#f57f17;">${curr}</span>`;
            } else {
                html += `<span class="term-box" style="opacity:${0.5 + i/(2*n_a)};">${curr}</span>`;
            }
        }
        
        html += `</div>
                    <p style="background:#fff9c4; padding:8px; border-radius:4px; margin-top:10px;">
                        <strong>Constat :</strong> On a fait ${n_a} ajouts de ${r_a}.<br>
                        <em>(Formule directe interdite dans le calcul : ${u0_a} + ${n_a}√ó${r_a} = ${curr})</em>
                    </p>
                </div>
            </div>
        </div>`;

        // EXERCICE B
        let p_b = getRandomInt(2, 4);
        let up_b = getRandomInt(10, 25);
        let r_b = getRandomInt(3, 6);
        let n_b = p_b + getRandomInt(3, 5);
        let nbSteps = n_b - p_b;
        
        html += `
        <div style="margin-bottom:30px;">
            <p><strong>Exercice B :</strong> suite arithm√©tique de raison \\( r=${r_b} \\). 
            On sait que \\( u_${p_b}=${up_b} \\). Calculez \\( u_${n_b} \\).</p>
            
            <button id="btn-dr2" class="btn-show-sol" onclick="toggleSol('dr2')">üëÅÔ∏è Voir la solution</button>
            <div id="sol-dr2" class="solution-box">
                <p><strong>Calculs progressifs √† partir de \\( u_${p_b} \\) :</strong></p>
                <div class="step-calc">`;
        
        let val_b = up_b;
        html += `D√©part : \\( u_${p_b} = ${val_b} \\)<br>`;
        for(let i=p_b+1; i<=n_b; i++) {
            let prev = val_b;
            val_b += r_b;
            html += `\\( u_${i} = ${prev} + ${r_b} = ${val_b} \\)<br>`;
        }
        
        html += `</div>
                <p>R√©sultat : \\( u_${n_b} = ${val_b} \\)</p>
                
                <div class="schema-box" style="background:#f3e5f5; border-color:#9c27b0;">
                    <h4>üîó Sch√©ma de la distance entre \\( u_${p_b} \\) et \\( u_${n_b} \\) :</h4>
                    <p>Nombre d'intervalles : \\( ${n_b} - ${p_b} = ${nbSteps} \\)</p>
                    <div style="margin:15px 0; overflow-x:auto;">`;
        
        html += `<div style="display:inline-block; text-align:center; margin:0 3px;">
                    <span class="term-box">${up_b}</span><br>
                    <small style="color:#666;">\\( u_${p_b} \\)</small>
                 </div>`;
        
        let currB = up_b;
        for(let i=p_b+1; i<=n_b; i++) {
            currB += r_b;
            let isLast = (i === n_b);
            html += `<span style="color:#d32f2f; font-weight:bold;">‚Üí(+${r_b})‚Üí</span>
                     <div style="display:inline-block; text-align:center; margin:0 3px;">
                        <span class="term-box" style="${isLast ? 'background:#ffeb3b; border-color:#f57f17;' : ''}">${currB}</span><br>
                        <small style="color:#666;">\\( u_${i} \\)</small>
                     </div>`;
        }
        
        html += `</div>
                    <p class="jump-label">Total ajout√© : ${nbSteps} √ó ${r_b} = ${nbSteps*r_b}</p>
                    <p style="background:#fff; padding:8px; border-radius:4px; margin-top:10px; border:1px dashed #9c27b0;">
                        <strong>Observation :</strong> On a fait ${nbSteps} pas de ${r_b}.<br>
                        <em>Constat final (formule g√©n√©rale) : 
                        \\( u_${n_b} = u_${p_b} + ${nbSteps} \\times ${r_b} = ${up_b} + ${nbSteps*r_b} = ${val_b} \\)</em>
                    </p>
                </div>
            </div>
        </div>`;

        container.innerHTML = html;
    }

    let modal = document.getElementById("copyrightModal");
    function openModal() { modal.style.display = "block"; }
    function closeModal() { modal.style.display = "none"; }
    window.onclick = function(e) { if (e.target == modal) closeModal(); }

    window.onload = generateContent;
</script>

</body>
</html>

